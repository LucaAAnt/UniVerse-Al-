<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal AI Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Smooth transitions for sidebar */
        .sidebar-transition { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        /* Custom scrollbar for that sleek Gemini feel */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
    </style>
</head>
<body class="bg-[#131314] text-gray-200 font-sans h-screen overflow-hidden flex">

    <aside id="sidebar" class="sidebar-transition w-64 bg-[#1e1f20] h-full flex flex-col p-4 z-20 absolute lg:relative -left-64 lg:left-0">
        <button onclick="createNewChat()" class="flex items-center gap-3 px-4 py-3 bg-[#28292a] hover:bg-[#333537] rounded-full text-sm font-medium transition-colors mb-8">
            <i class="fa-solid fa-plus"></i>
            <span>New Chat</span>
        </button>

        <div class="flex-1 overflow-y-auto" id="chatHistory">
            <p class="text-xs font-semibold text-gray-500 uppercase px-2 mb-4">Recent</p>
            </div>

        <div class="mt-auto pt-4 border-t border-gray-700">
            <button onclick="toggleSettings()" class="flex items-center gap-3 w-full px-4 py-2 hover:bg-[#333537] rounded-lg text-sm transition-colors">
                <i class="fa-solid fa-gear"></i>
                <span>Settings</span>
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-full relative">
        <header class="p-4 flex justify-between items-center">
            <button onclick="toggleSidebar()" class="lg:hidden p-2 hover:bg-gray-800 rounded-lg">
                <i class="fa-solid fa-bars"></i>
            </button>
            <div class="flex items-center gap-2">
                <span class="text-xl font-medium">Gemini</span>
                <span id="modelBadge" class="text-[10px] bg-blue-600 px-2 py-0.5 rounded text-white uppercase tracking-wider">Flash 2.0</span>
            </div>
            <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-xs">AI</div>
        </header>

        <div id="chatWindow" class="flex-1 overflow-y-auto p-4 md:p-8 space-y-8 max-w-4xl mx-auto w-full">
            <div id="welcomeView" class="h-full flex flex-col justify-center items-center text-center space-y-6">
                <h1 class="text-4xl font-semibold bg-gradient-to-r from-blue-400 via-purple-400 to-red-400 bg-clip-text text-transparent">Hello, how can I help?</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 w-full max-w-2xl">
                    <div class="p-4 bg-[#1e1f20] hover:bg-[#28292a] rounded-xl cursor-pointer border border-transparent hover:border-gray-700 transition-all" onclick="quickPrompt('Write a Python script to automate emails')">Write a Python script...</div>
                    <div class="p-4 bg-[#1e1f20] hover:bg-[#28292a] rounded-xl cursor-pointer border border-transparent hover:border-gray-700 transition-all" onclick="quickPrompt('Plan a 3-day trip to Tokyo')">Plan a 3-day trip...</div>
                </div>
            </div>
        </div>

        <footer class="p-4 md:pb-8">
            <div class="max-w-4xl mx-auto relative">
                <div class="bg-[#1e1f20] rounded-2xl p-2 border border-transparent focus-within:border-gray-600 transition-all shadow-xl">
                    <textarea id="userInput" rows="1" placeholder="Enter a prompt here..." 
                        class="w-full bg-transparent border-none focus:ring-0 resize-none px-4 py-2 text-gray-100 min-h-[56px]"></textarea>
                    <div class="flex justify-between items-center px-2 pb-1">
                        <div class="flex gap-2 text-gray-400">
                            <button class="p-2 hover:text-white transition-colors"><i class="fa-solid fa-image"></i></button>
                            <button class="p-2 hover:text-white transition-colors"><i class="fa-solid fa-microphone"></i></button>
                        </div>
                        <button id="sendBtn" onclick="handleSendMessage()" class="bg-blue-600 hover:bg-blue-500 text-white w-10 h-10 rounded-full flex items-center justify-center transition-all disabled:opacity-50">
                            <i class="fa-solid fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                <p class="text-[11px] text-gray-500 text-center mt-3 uppercase tracking-tighter">Powered by OpenRouter & Tailwind</p>
            </div>
        </footer>
    </main>

    <div id="settingsModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-[#1e1f20] w-full max-w-md rounded-2xl p-6 shadow-2xl border border-gray-700">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold">API Settings</h3>
                <button onclick="toggleSettings()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">OpenRouter API Key</label>
                    <input type="password" id="apiKey" class="w-full bg-[#131314] border border-gray-700 rounded-lg p-2.5 focus:border-blue-500 outline-none" placeholder="sk-or-v1-...">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Model ID</label>
                    <input type="text" id="modelId" class="w-full bg-[#131314] border border-gray-700 rounded-lg p-2.5 focus:border-blue-500 outline-none" placeholder="google/gemini-2.0-flash-001">
                </div>
                <button onclick="saveSettings()" class="w-full bg-white text-black font-bold py-2.5 rounded-lg mt-4 hover:bg-gray-200 transition-colors">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        let currentChatId = null;
        let chats = JSON.parse(localStorage.getItem('gemini_clone_chats') || '[]');
        let config = JSON.parse(localStorage.getItem('gemini_clone_config') || '{"apiKey": "", "model": "google/gemini-2.0-flash-001"}');

        // --- Initialization ---
        window.onload = () => {
            renderHistory();
            document.getElementById('apiKey').value = config.apiKey;
            document.getElementById('modelId').value = config.model;
            document.getElementById('modelBadge').innerText = config.model.split('/').pop();
            
            // Auto-resize textarea
            const tx = document.getElementById('userInput');
            tx.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
        };

        // --- UI Logic ---
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('-left-64');
            sidebar.classList.toggle('left-0');
        }

        function toggleSettings() {
            const modal = document.getElementById('settingsModal');
            modal.classList.toggle('hidden');
        }

        function saveSettings() {
            config.apiKey = document.getElementById('apiKey').value;
            config.model = document.getElementById('modelId').value;
            localStorage.setItem('gemini_clone_config', JSON.stringify(config));
            document.getElementById('modelBadge').innerText = config.model.split('/').pop();
            toggleSettings();
        }

        function createNewChat() {
            currentChatId = Date.now();
            document.getElementById('chatWindow').innerHTML = '';
            document.getElementById('welcomeView').classList.remove('hidden');
            renderHistory();
        }

        function quickPrompt(text) {
            document.getElementById('userInput').value = text;
            handleSendMessage();
        }

        // --- Core Chat Logic ---
        async function handleSendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message || !config.apiKey) {
                if(!config.apiKey) toggleSettings();
                return;
            }

            if (!currentChatId) currentChatId = Date.now();
            
            // UI Updates
            document.getElementById('welcomeView').classList.add('hidden');
            appendMessage('user', message);
            input.value = '';
            input.style.height = 'auto';

            // Find or create chat session
            let chat = chats.find(c => c.id === currentChatId);
            if (!chat) {
                chat = { id: currentChatId, title: message.substring(0, 30) + '...', messages: [] };
                chats.unshift(chat);
            }
            chat.messages.push({ role: 'user', content: message });
            
            const aiMessageId = appendMessage('ai', '...');
            
            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${config.apiKey}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": config.model,
                        "messages": chat.messages
                    })
                });

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                
                document.getElementById(aiMessageId).innerHTML = `<div class="prose prose-invert max-w-none">${aiResponse.replace(/\n/g, '<br>')}</div>`;
                chat.messages.push({ role: 'assistant', content: aiResponse });
                
                localStorage.setItem('gemini_clone_chats', JSON.stringify(chats));
                renderHistory();
                
            } catch (error) {
                document.getElementById(aiMessageId).innerText = "Error: Check API Key or Console.";
                console.error(error);
            }
        }

        function appendMessage(role, text) {
            const chatWindow = document.getElementById('chatWindow');
            const id = 'msg-' + Date.now();
            const isAI = role === 'ai';
            
            const html = `
                <div class="flex gap-4 md:gap-6 ${isAI ? 'bg-transparent' : 'justify-end'} animate-in fade-in duration-500">
                    ${isAI ? '<div class="w-8 h-8 rounded-full bg-blue-600 flex-shrink-0 flex items-center justify-center text-xs"><i class="fa-solid fa-sparkles"></i></div>' : ''}
                    <div class="${isAI ? 'flex-1' : 'bg-[#28292a] p-4 rounded-2xl max-w-[80%]'}">
                        <p id="${id}" class="leading-relaxed whitespace-pre-wrap">${text}</p>
                    </div>
                </div>
            `;
            
            chatWindow.insertAdjacentHTML('beforeend', html);
            chatWindow.scrollTo({ top: chatWindow.scrollHeight, behavior: 'smooth' });
            return id;
        }

        function renderHistory() {
            const container = document.getElementById('chatHistory');
            const historyHtml = chats.map(chat => `
                <div onclick="loadChat(${chat.id})" class="group flex items-center gap-3 px-3 py-2 hover:bg-[#28292a] rounded-lg cursor-pointer mb-1 transition-all">
                    <i class="fa-regular fa-message text-sm text-gray-400"></i>
                    <span class="text-sm truncate flex-1 text-gray-300">${chat.title}</span>
                </div>
            `).join('');
            
            // Keep the "Recent" header
            container.innerHTML = `<p class="text-xs font-semibold text-gray-500 uppercase px-2 mb-4">Recent</p>${historyHtml}`;
        }

        function loadChat(id) {
            const chat = chats.find(c => c.id === id);
            if (!chat) return;
            
            currentChatId = id;
            document.getElementById('welcomeView').classList.add('hidden');
            const chatWindow = document.getElementById('chatWindow');
            chatWindow.innerHTML = '';
            
            chat.messages.forEach(msg => {
                appendMessage(msg.role === 'user' ? 'user' : 'ai', msg.content);
            });
        }
    </script>
</body>
</html>
